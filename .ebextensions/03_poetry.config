commands:
  01_install_poetry:
    test: 'test -x /root/.local/bin/poetry'
    command: |
      curl -sSL https://install.python-poetry.org | POETRY_HOME=/usr/local python3 -
      export PATH="/usr/local/bin:$PATH"
      /usr/local/bin/poetry --version
      echo 'export PATH="/usr/local/bin:$PATH"' >> ~/.bashrc
      source ~/.bashrc

container_commands:
  02poetry_config:
    cwd: "/var/app/staging"
    command: "/usr/local/bin/poetry config virtualenvs.create true"

  03poetry_lock:
    cwd: "/var/app/staging"
    command: "/usr/local/bin/poetry lock"

  04poetry_install:
    cwd: "/var/app/staging"
    command: "/usr/local/bin/poetry install --no-interaction --no-ansi --only main --no-root"
